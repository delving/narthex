# Routes
# This file defines all application routes (Higher priority routes first)
# ~~~~

#->          /webjars                                                         webjars.Routes
->          /narthex/webjars                                                 webjars.Routes

#GET         /assets/*file                                controllers.Assets.at(file)
#GET         /narthex/assets/*file                                            controllers.Assets.versioned(path="/public", file: Asset)
#GET         /assets/*file                                                    controllers.Assets.at(file)
#GET         /assets/*file                                                    controllers.Assets.versioned(path="/public", file: Asset)
#GET         /assets/javascripts/*file                                        controllers.Assets.versioned(path="/public", file: Asset)
#GET         /narthex/assets/*file                                            controllers.Assets.versioned(file)
#GET         /webjars/*file                                                   org.webjars.play.WebJarAssets.at(file)
#GET     /narthex/assets/*file               controllers.Assets.versioned(path="/public", file: Asset)

# Home page
GET         /                                                                controllers.MainController.root
GET         /narthex/                                                        controllers.MainController.index
GET         /narthex/logout                                                  controllers.MainController.logout

# JavaScript routes object
GET         /narthex/jsRoutes.js                                             controllers.MainController.jsRoutes()

# Webhook endpoints (from Hub3)
+ nocsrf
POST        /narthex/webhook/indexing                                        controllers.WebhookController.indexingComplete

# File Handling
GET         /narthex/socket/dataset                                          controllers.WebSocketController.dataset
GET         /narthex/app/dataset-list                                        controllers.AppController.listDatasets
GET         /narthex/app/dataset-list-light                                  controllers.AppController.listDatasetsLight
GET         /narthex/app/active-datasets                                     controllers.AppController.listActiveDatasets
+ nocsrf
POST        /narthex/app/cancel-queue/:spec                                  controllers.AppController.cancelQueuedOperation(spec)
GET         /narthex/app/index-stats                                         controllers.AppController.indexStats
GET         /narthex/app/index-stats/wrong-count                             controllers.AppController.indexStatsWrongCount
GET         /narthex/app/index-stats-with-trends                             controllers.AppController.indexStatsWithTrends
GET         /narthex/app/trends                                              controllers.AppController.getOrganizationTrends
GET         /narthex/app/trends/:spec                                        controllers.AppController.getDatasetTrends(spec)
+ nocsrf
POST        /narthex/app/trends/snapshot                                     controllers.AppController.triggerTrendSnapshot
GET         /narthex/app/prefixes                                            controllers.AppController.listPrefixes
GET         /narthex/app/dataset/:spec/create/:character/:prefix             controllers.AppController.createDataset(spec, character, prefix)
+ nocsrf
POST        /narthex/app/dataset/:spec/upload                                controllers.AppController.uploadDataset(spec)
+ nocsrf
POST        /narthex/app/dataset/:spec/set-properties                        controllers.AppController.setDatasetProperties(spec)
+ nocsrf
POST        /narthex/app/dataset/:spec/toggle-skos                           controllers.AppController.toggleSkosifiedField(spec)
+ nocsrf
POST        /narthex/app/dataset/:spec/set-delimiter                         controllers.AppController.setRecordDelimiter(spec)
GET         /narthex/app/dataset/:spec/index                                 controllers.AppController.index(spec)
GET         /narthex/app/dataset/:spec/info                                  controllers.AppController.datasetInfo(spec)
GET         /narthex/app/dataset/:spec/command/:command                      controllers.AppController.command(spec, command)
GET         /narthex/app/dataset/:spec/status/*path                          controllers.AppController.nodeStatus(spec, path)
GET         /narthex/app/dataset/:spec/sample/:size/*path                    controllers.AppController.sample(spec, path, size:Int)
GET         /narthex/app/dataset/:spec/histogram/:size/*path                 controllers.AppController.histogram(spec, path, size:Int)

# Source analysis stats
GET         /narthex/app/dataset/:spec/source-index                          controllers.AppController.sourceIndex(spec)
GET         /narthex/app/dataset/:spec/source-status/*path                   controllers.AppController.sourceNodeStatus(spec, path)
GET         /narthex/app/dataset/:spec/source-sample/:size/*path             controllers.AppController.sourceSample(spec, path, size:Int)
GET         /narthex/app/dataset/:spec/source-histogram/:size/*path          controllers.AppController.sourceHistogram(spec, path, size:Int)

# Quality summary dashboard
GET         /narthex/app/dataset/:spec/quality-summary                       controllers.AppController.qualitySummary(spec)
GET         /narthex/app/dataset/:spec/source-quality-summary                controllers.AppController.sourceQualitySummary(spec)
GET         /narthex/app/dataset/:spec/export-quality-json                   controllers.AppController.exportQualitySummaryJson(spec, isSource: Boolean ?= false)
GET         /narthex/app/dataset/:spec/export-quality-csv                    controllers.AppController.exportQualitySummaryCsv(spec, isSource: Boolean ?= false)

GET         /narthex/app/dataset/:spec/term/vocab                            controllers.AppController.getTermVocabulary(spec)
GET         /narthex/app/dataset/:spec/term/get-mappings                     controllers.AppController.getTermMappings(spec)
+ nocsrf
POST        /narthex/app/dataset/:spec/term/:vocabSpec/toggle-mapping        controllers.AppController.toggleTermMapping(spec, vocabSpec)
GET         /narthex/app/dataset/:spec/category/get-mappings                 controllers.AppController.getCategoryMappings(spec)

GET         /narthex/app/skos/list                                           controllers.AppController.listVocabularies
GET         /narthex/app/skos/:spec/create                                   controllers.AppController.createVocabulary(spec)
GET         /narthex/app/skos/:spec/delete                                   controllers.AppController.deleteVocabulary(spec)
+ nocsrf
POST        /narthex/app/skos/:spec/upload                                   controllers.AppController.uploadVocabulary(spec)
+ nocsrf
POST        /narthex/app/skos/:spec/set-properties                           controllers.AppController.setVocabularyProperties(spec)
GET         /narthex/app/skos/:spec/info                                     controllers.AppController.vocabularyInfo(spec)
GET         /narthex/app/skos/:spec/statistics                               controllers.AppController.vocabularyStatistics(spec)
GET         /narthex/app/skos/:spec/languages                                controllers.AppController.getVocabularyLanguages(spec)
GET         /narthex/app/skos/:spec/search/:sought/:language                 controllers.AppController.searchVocabulary(spec, sought, language)
GET         /narthex/app/skos/:specA/:specB/get-mappings                     controllers.AppController.getSkosMappings(specA, specB)
+ nocsrf
POST        /narthex/app/skos/:specA/:specB/toggle-mapping                   controllers.AppController.toggleSkosMapping(specA, specB)


GET         /narthex/app/category-list                                       controllers.AppController.getCategoryList
GET         /narthex/app/sheets-list                                         controllers.AppController.listSheets
GET         /narthex/app/sheet/:spec                                         controllers.AppController.sheet(spec)
GET         /narthex/app/categories/gather-counts                            controllers.AppController.gatherCategoryCounts

# Default Mappings - Named Mappings Structure (prefix/name/versions)
GET         /narthex/app/default-mappings                                    controllers.AppController.listDefaultMappings
GET         /narthex/app/default-mappings/:prefix                            controllers.AppController.listMappingsForPrefix(prefix)
GET         /narthex/app/default-mappings/:prefix/:name                      controllers.AppController.getNamedMappingInfo(prefix, name)
GET         /narthex/app/default-mappings/:prefix/:name/xml/:version         controllers.AppController.getDefaultMappingXml(prefix, name, version)
+ nocsrf
POST        /narthex/app/default-mappings/:prefix/create                     controllers.AppController.createNamedMapping(prefix)
+ nocsrf
POST        /narthex/app/default-mappings/:prefix/:name/upload               controllers.AppController.uploadDefaultMapping(prefix, name)
+ nocsrf
POST        /narthex/app/default-mappings/:prefix/:name/copy-from/:spec      controllers.AppController.copyMappingFromDataset(prefix, name, spec)
+ nocsrf
POST        /narthex/app/default-mappings/:prefix/:name/set-current          controllers.AppController.setCurrentDefaultMapping(prefix, name)
+ nocsrf
DELETE      /narthex/app/default-mappings/:prefix/:name/versions/:hash       controllers.AppController.deleteDefaultMappingVersion(prefix, name, hash)

# Dataset Mapping Source
GET         /narthex/app/dataset/:spec/mapping-versions                      controllers.AppController.listDatasetMappingVersions(spec)
GET         /narthex/app/dataset/:spec/mapping-xml/:version                  controllers.AppController.getDatasetMappingXml(spec, version)
+ nocsrf
POST        /narthex/app/dataset/:spec/set-mapping-source                    controllers.AppController.setDatasetMappingSource(spec)
+ nocsrf
POST        /narthex/app/dataset/:spec/rollback-mapping/:hash                controllers.AppController.rollbackDatasetMapping(spec, hash)

# Dataset Discovery - OAI-PMH Sources
GET         /narthex/app/discovery/sources                                   controllers.DiscoveryController.listSources
GET         /narthex/app/discovery/sources/:id                               controllers.DiscoveryController.getSource(id)
+ nocsrf
POST        /narthex/app/discovery/sources                                   controllers.DiscoveryController.createSource
+ nocsrf
PUT         /narthex/app/discovery/sources/:id                               controllers.DiscoveryController.updateSource(id)
+ nocsrf
DELETE      /narthex/app/discovery/sources/:id                               controllers.DiscoveryController.deleteSource(id)
GET         /narthex/app/discovery/sources/:id/discover                      controllers.DiscoveryController.discoverSets(id)
+ nocsrf
POST        /narthex/app/discovery/sources/:id/ignore                        controllers.DiscoveryController.ignoreSets(id)
+ nocsrf
POST        /narthex/app/discovery/sources/:id/unignore                      controllers.DiscoveryController.unignoreSets(id)
+ nocsrf
POST        /narthex/app/discovery/import                                    controllers.DiscoveryController.importSets
+ nocsrf
POST        /narthex/app/discovery/preview-spec                              controllers.DiscoveryController.previewSpecTransform

GET         /narthex/app/dataset/:spec/sip-list                              controllers.AppController.listSipFiles(spec)
GET         /narthex/app/dataset/:spec/delete-latest                         controllers.AppController.deleteLatestSipFile(spec)

# sip-app
+ nocsrf
GET         /narthex/sip-app                                                 controllers.SipAppController.listSipZips()
+ nocsrf
GET         /narthex/sip-app/:spec                                           controllers.SipAppController.downloadSipZip(spec)
+ nocsrf
POST        /narthex/sip-app/:spec/:zipFileName                              controllers.SipAppController.uploadSipZip(spec, zipFileName)

GET         /narthex/api/:spec                                               controllers.APIController.pathsJSON(spec)
GET         /narthex/api/:spec/errors                                        controllers.APIController.processingErrorsText(spec)
GET         /narthex/api/:spec/bulkactions                                   controllers.APIController.processingBulkActionText(spec)
GET         /narthex/api/:spec/nquads                                        controllers.APIController.processingNquads(spec)
GET         /narthex/api/:spec/sourced                                       controllers.APIController.processingSourcedText(spec)
GET         /narthex/api/:spec/processed                                     controllers.APIController.processingProcessedText(spec)
GET         /narthex/api/:spec/log                                           controllers.APIController.processingHarvestingLog(spec)
GET         /narthex/api/:spec/activity                                      controllers.APIController.activityLog(spec)
GET         /narthex/api/:spec/tree                                          controllers.APIController.indexJSON(spec)
GET         /narthex/api/:spec/unique/*path                                  controllers.APIController.uniqueText(spec, path)
GET         /narthex/api/:spec/histogram/*path                               controllers.APIController.histogramText(spec, path)

# Static
#GET         /narthex/webjars/*file                                           controllers.WebJarAssets.at(file)
#GET         /narthex/assets/*file                                            controllers.Assets.versioned(path="/public", file: Asset)
GET         /narthex/webjars/*file                                           org.webjars.play.WebJarAssets.at(file)
GET         /narthex/assets/*file                                            controllers.Assets.versioned(path="/public", file: Asset)

# Mapping Editor SPA (Svelte)
GET         /narthex/editor                                                  controllers.Assets.at(path="/public/editor", file="index.html")
GET         /narthex/editor/                                                 controllers.Assets.at(path="/public/editor", file="index.html")
GET         /narthex/editor/*file                                            controllers.Assets.at(path="/public/editor", file)

# Monitoring
GET         /non-public/monitoring/metrics                                   com.kenshoo.play.metrics.MetricsController.metrics
GET         /non-public/monitoring/info                                      controllers.InfoController.info
GET         /non-public/monitoring/health                                    controllers.InfoController.health
GET         /non-public/monitoring/connection-stats                          controllers.InfoController.connectionStats

# Preview functionality for harvest URLs
# JSON harvest preview - fetches first page and transforms to XML (must come before wildcard route)
GET         /narthex/preview/json/:spec                                      web.PreviewController.previewJsonHarvest(spec)

# Generic preview for OAI-PMH and AdLib harvest URLs (wildcard route)
GET         /narthex/preview/*dataUrl                                        web.PreviewController.previewHarvestUrl(dataUrl)

# SIP Creator Downloads (public endpoint, no auth required)
GET         /narthex/api/sip-creator/downloads                               controllers.SipCreatorDownloadsController.getDownloads(refresh: Boolean ?= false)
