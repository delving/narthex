# ================== hub3 nginx  Configuration ==================
#
# File generated by ansible, any local changes will be overwritten!
#
# serial# to force config file propagation: x2
#
# ==============================================================

upstream dcn {
    server 127.0.0.1:8000;
}

upstream barbatos {
    server 127.0.0.1:8080;
}

upstream rapid {
    server 127.0.0.1:3002;
}

upstream rdf-webresource {
        server 188.245.148.196:8000;
}

log_format $(proj_name)s_format '$remote_addr - $remote_user [$time_local] '
      '"$request" $status $bytes_sent $request_length $request_time $body_bytes_sent'
      '"$http_referer" "$http_user_agent" "$gzip_ratio"';

log_format upstream_time '$remote_addr - $remote_user [$time_local] '
                             '"$request" $status $body_bytes_sent '
                             '"$http_referer" "$http_user_agent" '
                             'rt=$request_time uct="$upstream_connect_time" uht="$upstream_header_time" urt="$upstream_response_time"';


server {
    #listen 443 ssl;
    # separate hostnames with space...
    server_name collectienederland.nl prod.dcn.hubs.delving.org data.collectienederland.nl www.collectienederland.nl .dimcon.nl prod.dcn.hubs.delving.io;

    client_max_body_size 250m;
    keepalive_timeout    70;


    access_log /var/log/hub3-dcn/nginx.log upstream_time;
    error_log /var/log/hub3-dcn/nginx-error.log;

   location /deepzoom/ {
       if ($http_user_agent ~ (libwww|Wget|LWP|damnBot|BBBike|java|spider|crawl) ) {
            return 403;
        }
        proxy_redirect      off;
        proxy_set_header    Host                    $host;
        proxy_set_header    X-Real-IP               $remote_addr;
        proxy_set_header    X-Forwarded-For         $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Protocol    $scheme;
        proxy_pass          http://rdf-webresource/deepzoom/;
    }

   location /explore/ {
       if ($http_user_agent ~ (libwww|Wget|LWP|damnBot|BBBike|java|spider|crawl) ) {
            return 403;
        }
        proxy_redirect      off;
        proxy_set_header    Host                    $host;
        proxy_set_header    X-Real-IP               $remote_addr;
        proxy_set_header    X-Forwarded-For         $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Protocol    $scheme;
        proxy_pass          http://rdf-webresource/explore/;
    }

   location /thumbnail/ {
       if ($http_user_agent ~ (libwww|Wget|LWP|damnBot|BBBike|java|spider|crawl) ) {
            return 403;
        }
        proxy_redirect      off;
        proxy_set_header    Host                    $host;
        proxy_set_header    X-Real-IP               $remote_addr;
        proxy_set_header    X-Forwarded-For         $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Protocol    $scheme;
        proxy_pass          http://rdf-webresource/thumbnail/;
    }

    location /wo2 {
	return 301 https://wo2.collectienederland.nl;
    }

location /api/search/v3 {
        proxy_pass          http://rapid/api/search/v2;
#        proxy_ssl_server_name   on;
        proxy_redirect      off;
	proxy_set_header    Host                    $host;
	proxy_set_header    X-Real-IP               $remote_addr;
	proxy_set_header    X-Forwarded-For         $proxy_add_x_forwarded_for;
	proxy_set_header    X-Forwarded-Protocol    $scheme;
}
location /sparql {
        proxy_pass          http://rapid;
#        proxy_ssl_server_name   on;
        proxy_redirect      off;
	proxy_set_header    Host                    $host;
	proxy_set_header    X-Real-IP               $remote_addr;
	proxy_set_header    X-Forwarded-For         $proxy_add_x_forwarded_for;
	proxy_set_header    X-Forwarded-Protocol    $scheme;
}

location /pocs {
    root /opt/hub3/static/;
    index index.html index.htm;
    try_files $uri $uri/ =404;
}

location /fragments {
        proxy_pass          http://rapid;
#        proxy_ssl_server_name   on;
        proxy_redirect      off;
	proxy_set_header    Host                    $host;
	proxy_set_header    X-Real-IP               $remote_addr;
	proxy_set_header    X-Forwarded-For         $proxy_add_x_forwarded_for;
	proxy_set_header    X-Forwarded-Protocol    $scheme;
}


    location / {
       deny 170.106.168.0/21;
       deny 170.106.176.0/20;
       deny 43.134.0.0/18;
deny 101.32.114.234;
deny 101.32.127.118;
deny 101.32.127.27;
deny 101.32.141.123;
deny 101.32.141.14;
deny 101.32.142.167;
deny 101.32.163.166;
deny 101.32.164.137;
deny 101.32.165.238;
deny 101.32.165.252;
deny 101.32.168.219;
deny 101.32.168.39;
deny 101.32.243.115;
deny 101.32.254.131;
deny 101.32.254.44;
deny 101.33.109.130;
deny 124.156.192.106;
deny 124.156.192.118;
deny 124.156.192.207;
deny 124.156.192.55;
deny 124.156.193.230;
deny 124.156.193.58;
deny 124.156.193.7;
deny 124.156.196.64;
deny 124.156.197.8;
deny 124.156.200.119;
deny 124.156.201.57;
deny 124.156.201.64;
deny 124.156.202.167;
deny 124.156.202.90;
deny 124.156.205.250;
deny 124.156.207.61;
deny 129.226.145.159;
deny 129.226.146.77;
deny 129.226.147.7;
deny 129.226.149.125;
deny 129.226.149.179;
deny 129.226.149.54;
deny 129.226.149.74;
deny 129.226.150.172;
deny 129.226.154.57;
deny 129.226.157.219;
deny 129.226.158.3;
deny 129.226.158.53;
deny 129.226.192.252;
deny 129.226.194.17;
deny 129.226.195.189;
deny 129.226.198.204;
deny 129.226.198.238;
deny 129.226.202.246;
deny 129.226.205.161;
deny 129.226.208.215;
deny 129.226.208.41;
deny 129.226.209.193;
deny 129.226.210.236;
deny 129.226.221.91;
deny 129.226.222.161;
deny 129.226.81.254;
deny 129.226.83.251;
deny 129.226.84.20;
deny 129.226.84.70;
deny 129.226.88.33;
deny 129.226.89.241;
deny 129.226.91.176;
deny 129.226.92.47;
deny 129.226.93.221;
deny 150.109.10.166;
deny 150.109.11.82;
deny 150.109.12.239;
deny 150.109.12.69;
deny 150.109.12.94;
deny 150.109.13.194;
deny 150.109.14.234;
deny 150.109.15.130;
deny 150.109.16.110;
deny 150.109.18.116;
deny 150.109.19.195;
deny 150.109.19.63;
deny 150.109.94.201;
deny 150.109.95.94;
deny 170.106.105.240;
deny 170.106.107.120;
deny 170.106.110.183;
deny 170.106.115.162;
deny 170.106.115.67;
deny 170.106.136.103;
deny 170.106.136.233;
deny 170.106.141.111;
deny 170.106.141.74;
deny 170.106.142.238;
deny 170.106.147.108;
deny 170.106.147.38;
deny 170.106.150.114;
deny 170.106.151.35;
deny 170.106.153.163;
deny 170.106.153.245;
deny 170.106.155.233;
deny 170.106.158.124;
deny 170.106.159.138;
deny 170.106.169.112;
deny 170.106.169.164;
deny 170.106.169.50;
deny 170.106.172.4;
deny 170.106.173.20;
deny 170.106.174.182;
deny 170.106.174.20;
deny 170.106.175.191;
deny 170.106.177.250;
deny 170.106.178.34;
deny 170.106.178.56;
deny 170.106.180.62;
deny 170.106.181.131;
deny 170.106.187.200;
deny 170.106.187.53;
deny 170.106.187.63;
deny 170.106.187.66;
deny 170.106.187.69;
deny 170.106.190.200;
deny 170.106.193.58;
deny 170.106.194.150;
deny 170.106.194.156;
deny 170.106.194.210;
deny 170.106.196.233;
deny 170.106.198.61;
deny 170.106.199.80;
deny 170.106.65.152;
deny 170.106.65.189;
deny 170.106.72.192;
deny 170.106.74.130;
deny 170.106.74.7;
deny 170.106.76.142;
deny 170.106.82.74;
deny 170.106.83.161;
deny 170.106.98.102;
deny 170.106.98.37;
deny 170.106.99.139;
deny 170.106.99.237;
deny 43.128.100.5;
deny 43.128.101.103;
deny 43.128.102.17;
deny 43.128.102.83;
deny 43.128.103.189;
deny 43.128.103.229;
deny 43.128.111.102;
deny 43.128.111.142;
deny 43.128.111.243;
deny 43.128.112.48;
deny 43.128.113.150;
deny 43.128.115.212;
deny 43.128.117.84;
deny 43.128.118.93;
deny 43.128.120.163;
deny 43.128.66.148;
deny 43.128.67.167;
deny 43.128.67.227;
deny 43.128.70.47;
deny 43.128.72.105;
deny 43.128.72.228;
deny 43.128.74.202;
deny 43.128.75.242;
deny 43.128.78.196;
deny 43.128.78.228;
deny 43.128.79.174;
deny 43.128.81.169;
deny 43.128.85.28;
deny 43.128.87.131;
deny 43.128.87.66;
deny 43.128.93.243;
deny 43.128.93.82;
deny 43.128.97.219;
deny 43.128.98.116;
deny 43.128.98.129;
deny 43.128.98.87;
deny 43.128.99.181;
deny 43.130.0.79;
deny 43.130.11.194;
deny 43.130.1.248;
deny 43.130.1.76;
deny 43.130.2.19;
deny 43.130.26.11;
deny 43.130.27.148;
deny 43.130.27.87;
deny 43.130.28.210;
deny 43.130.29.87;
deny 43.130.3.13;
deny 43.130.3.183;
deny 43.130.3.21;
deny 43.130.32.150;
deny 43.130.3.226;
deny 43.130.32.85;
deny 43.130.33.143;
deny 43.130.34.41;
deny 43.130.35.78;
deny 43.130.37.114;
deny 43.130.39.202;
deny 43.130.40.60;
deny 43.130.41.64;
deny 43.130.41.95;
deny 43.130.42.59;
deny 43.130.42.67;
deny 43.130.42.93;
deny 43.130.48.6;
deny 43.130.49.20;
deny 43.130.52.114;
deny 43.130.52.125;
deny 43.130.56.233;
deny 43.130.57.167;
deny 43.130.59.207;
deny 43.130.60.104;
deny 43.130.7.25;
deny 43.132.150.96;
deny 43.133.33.175;
deny 43.133.34.181;
deny 43.133.35.38;
deny 43.133.37.211;
deny 43.133.38.226;
deny 43.133.40.235;
deny 43.133.40.4;
deny 43.133.42.207;
deny 43.133.43.180;
deny 43.133.43.59;
deny 43.133.44.162;
deny 43.133.44.44;
deny 43.133.46.109;
deny 43.133.47.170;
deny 43.133.49.58;
deny 43.133.57.126;
deny 43.133.57.14;
deny 43.133.57.36;
deny 43.133.59.123;
deny 43.134.0.117;
deny 43.134.102.154;
deny 43.134.103.160;
deny 43.134.104.126;
deny 43.134.105.20;
deny 43.134.106.147;
deny 43.134.106.69;
deny 43.134.107.22;
deny 43.134.108.179;
deny 43.134.109.121;
deny 43.134.110.59;
deny 43.134.111.115;
deny 43.134.111.187;
deny 43.134.1.120;
deny 43.134.112.198;
deny 43.134.115.96;
deny 43.134.118.191;
deny 43.134.121.124;
deny 43.134.121.73;
deny 43.134.124.142;
deny 43.134.124.58;
deny 43.134.127.202;
deny 43.134.128.142;
deny 43.134.129.178;
deny 43.134.130.85;
deny 43.134.13.212;
deny 43.134.13.43;
deny 43.134.136.45;
deny 43.134.14.106;
deny 43.134.142.74;
deny 43.134.15.98;
deny 43.134.16.221;
deny 43.134.163.214;
deny 43.134.163.40;
deny 43.134.165.14;
deny 43.134.165.81;
deny 43.134.166.154;
deny 43.134.166.30;
deny 43.134.166.66;
deny 43.134.166.70;
deny 43.134.169.48;
deny 43.134.17.189;
deny 43.134.173.52;
deny 43.134.174.7;
deny 43.134.175.251;
deny 43.134.176.210;
deny 43.134.176.35;
deny 43.134.176.43;
deny 43.134.177.30;
deny 43.134.179.101;
deny 43.134.179.254;
deny 43.134.180.127;
deny 43.134.18.170;
deny 43.134.185.163;
deny 43.134.185.47;
deny 43.134.21.193;
deny 43.134.22.116;
deny 43.134.22.214;
deny 43.134.224.208;
deny 43.134.227.133;
deny 43.134.22.89;
deny 43.134.23.119;
deny 43.134.231.233;
deny 43.134.232.166;
deny 43.134.235.54;
deny 43.134.239.251;
deny 43.134.239.37;
deny 43.134.240.58;
deny 43.134.240.90;
deny 43.134.241.153;
deny 43.134.241.249;
deny 43.134.25.253;
deny 43.134.25.54;
deny 43.134.26.90;
deny 43.134.27.228;
deny 43.134.28.141;
deny 43.134.29.208;
deny 43.134.30.31;
deny 43.134.32.238;
deny 43.134.33.140;
deny 43.134.38.200;
deny 43.134.38.235;
deny 43.134.40.182;
deny 43.134.40.99;
deny 43.134.44.183;
deny 43.134.48.112;
deny 43.134.48.23;
deny 43.134.51.12;
deny 43.134.51.163;
deny 43.134.51.73;
deny 43.134.54.196;
deny 43.134.54.78;
deny 43.134.55.251;
deny 43.134.56.13;
deny 43.134.56.169;
deny 43.134.56.246;
deny 43.134.56.73;
deny 43.134.58.104;
deny 43.134.59.219;
deny 43.134.60.234;
deny 43.134.60.39;
deny 43.134.63.78;
deny 43.134.64.3;
deny 43.134.64.60;
deny 43.134.66.205;
deny 43.134.66.4;
deny 43.134.70.194;
deny 43.134.75.184;
deny 43.134.75.81;
deny 43.134.79.169;
deny 43.134.8.124;
deny 43.134.82.169;
deny 43.134.84.8;
deny 43.134.85.54;
deny 43.134.91.216;
deny 43.134.92.191;
deny 43.134.93.74;
deny 43.134.9.53;
deny 43.134.96.28;
deny 43.134.97.233;
deny 43.134.97.68;
deny 43.134.98.68;
deny 43.135.129.224;
deny 43.135.130.165;
deny 43.135.131.150;
deny 43.135.133.130;
deny 43.135.136.204;
deny 43.135.136.236;
deny 43.135.137.152;
deny 43.135.139.205;
deny 43.135.140.149;
deny 43.135.141.217;
deny 43.135.142.50;
deny 43.135.142.69;
deny 43.135.144.54;
deny 43.135.146.187;
deny 43.135.147.138;
deny 43.135.147.18;
deny 43.135.149.234;
deny 43.135.149.250;
deny 43.135.153.185;
deny 43.135.155.102;
deny 43.135.158.230;
deny 43.135.158.34;
deny 43.135.159.134;
deny 43.135.159.208;
deny 43.135.159.216;
deny 43.135.159.26;
deny 43.135.159.96;
deny 43.135.161.160;
deny 43.135.162.119;
deny 43.135.163.193;
deny 43.135.165.198;
deny 43.135.165.40;
deny 43.135.166.208;
deny 43.135.166.219;
deny 43.135.167.192;
deny 43.135.167.231;
deny 43.135.167.253;
deny 43.135.169.50;
deny 43.135.173.26;
deny 43.135.173.59;
deny 43.135.174.144;
deny 43.135.174.245;
deny 43.135.176.106;
deny 43.135.177.231;
deny 43.135.177.80;
deny 43.135.178.215;
deny 43.135.178.243;
deny 43.135.179.9;
deny 43.135.182.14;
deny 43.135.183.8;
deny 43.135.185.53;
deny 43.135.186.150;
deny 43.135.191.137;
deny 43.152.72.18;
deny 43.152.72.240;
deny 43.153.100.21;
deny 43.153.10.105;
deny 43.153.102.69;
deny 43.153.103.107;
deny 43.153.103.133;
deny 43.153.103.139;
deny 43.153.105.222;
deny 43.153.105.79;
deny 43.153.107.175;
deny 43.153.109.199;
deny 43.153.110.131;
deny 43.153.111.142;
deny 43.153.11.220;
deny 43.153.112.216;
deny 43.153.113.119;
deny 43.153.114.143;
deny 43.153.114.251;
deny 43.153.115.253;
deny 43.153.116.230;
deny 43.153.116.245;
deny 43.153.116.64;
deny 43.153.120.152;
deny 43.153.121.28;
deny 43.153.122.24;
deny 43.153.122.59;
deny 43.153.123.200;
deny 43.153.1.239;
deny 43.153.13.191;
deny 43.153.13.218;
deny 43.153.15.105;
deny 43.153.15.11;
deny 43.153.17.105;
deny 43.153.17.240;
deny 43.153.19.177;
deny 43.153.192.40;
deny 43.153.19.242;
deny 43.153.195.32;
deny 43.153.196.68;
deny 43.153.201.195;
deny 43.153.20.173;
deny 43.153.20.183;
deny 43.153.20.23;
deny 43.153.20.52;
deny 43.153.207.129;
deny 43.153.207.149;
deny 43.153.20.93;
deny 43.153.210.146;
deny 43.153.210.232;
deny 43.153.211.203;
deny 43.153.212.197;
deny 43.153.212.89;
deny 43.153.214.84;
deny 43.153.21.56;
deny 43.153.21.65;
deny 43.153.216.71;
deny 43.153.21.70;
deny 43.153.220.31;
deny 43.153.224.21;
deny 43.153.225.248;
deny 43.153.226.52;
deny 43.153.226.93;
deny 43.153.227.119;
deny 43.153.228.107;
deny 43.153.229.133;
deny 43.153.23.157;
deny 43.153.23.47;
deny 43.153.24.105;
deny 43.153.24.22;
deny 43.153.244.100;
deny 43.153.244.101;
deny 43.153.244.102;
deny 43.153.244.103;
deny 43.153.244.110;
deny 43.153.244.111;
deny 43.153.244.117;
deny 43.153.244.119;
deny 43.153.244.12;
deny 43.153.244.121;
deny 43.153.244.123;
deny 43.153.244.129;
deny 43.153.244.132;
deny 43.153.244.135;
deny 43.153.244.137;
deny 43.153.244.138;
deny 43.153.244.143;
deny 43.153.244.145;
deny 43.153.244.146;
deny 43.153.244.148;
deny 43.153.244.149;
deny 43.153.244.15;
deny 43.153.244.151;
deny 43.153.244.153;
deny 43.153.244.154;
deny 43.153.244.156;
deny 43.153.244.157;
deny 43.153.244.159;
deny 43.153.244.16;
deny 43.153.244.160;
deny 43.153.244.164;
deny 43.153.244.167;
deny 43.153.244.169;
deny 43.153.244.171;
deny 43.153.244.177;
deny 43.153.244.178;
deny 43.153.244.18;
deny 43.153.244.186;
deny 43.153.244.188;
deny 43.153.244.189;
deny 43.153.244.190;
deny 43.153.244.194;
deny 43.153.244.195;
deny 43.153.244.196;
deny 43.153.244.197;
deny 43.153.244.199;
deny 43.153.244.201;
deny 43.153.244.202;
deny 43.153.244.205;
deny 43.153.244.206;
deny 43.153.244.207;
deny 43.153.244.210;
deny 43.153.244.211;
deny 43.153.244.212;
deny 43.153.244.214;
deny 43.153.244.215;
deny 43.153.244.217;
deny 43.153.244.218;
deny 43.153.244.219;
deny 43.153.244.22;
deny 43.153.244.223;
deny 43.153.244.225;
deny 43.153.244.226;
deny 43.153.244.229;
deny 43.153.244.230;
deny 43.153.244.233;
deny 43.153.244.237;
deny 43.153.244.238;
deny 43.153.244.244;
deny 43.153.244.246;
deny 43.153.244.248;
deny 43.153.244.249;
deny 43.153.244.250;
deny 43.153.244.251;
deny 43.153.244.252;
deny 43.153.244.253;
deny 43.153.244.26;
deny 43.153.244.29;
deny 43.153.244.31;
deny 43.153.244.33;
deny 43.153.244.34;
deny 43.153.244.37;
deny 43.153.244.38;
deny 43.153.244.4;
deny 43.153.244.43;
deny 43.153.244.44;
deny 43.153.244.46;
deny 43.153.244.49;
deny 43.153.244.52;
deny 43.153.244.53;
deny 43.153.244.56;
deny 43.153.244.59;
deny 43.153.244.64;
deny 43.153.244.67;
deny 43.153.244.68;
deny 43.153.244.69;
deny 43.153.244.7;
deny 43.153.244.70;
deny 43.153.244.71;
deny 43.153.244.73;
deny 43.153.244.76;
deny 43.153.244.79;
deny 43.153.244.8;
deny 43.153.244.82;
deny 43.153.244.83;
deny 43.153.244.84;
deny 43.153.244.85;
deny 43.153.244.90;
deny 43.153.251.170;
deny 43.153.26.32;
deny 43.153.27.237;
deny 43.153.28.185;
deny 43.153.28.52;
deny 43.153.29.143;
deny 43.153.30.17;
deny 43.153.36.115;
deny 43.153.36.126;
deny 43.153.36.98;
deny 43.153.37.11;
deny 43.153.37.148;
deny 43.153.38.17;
deny 43.153.38.58;
deny 43.153.39.234;
deny 43.153.39.235;
deny 43.153.40.233;
deny 43.153.41.153;
deny 43.153.41.229;
deny 43.153.4.148;
deny 43.153.42.21;
deny 43.153.4.253;
deny 43.153.4.28;
deny 43.153.43.144;
deny 43.153.44.55;
deny 43.153.45.136;
deny 43.153.45.53;
deny 43.153.46.11;
deny 43.153.47.120;
deny 43.153.47.215;
deny 43.153.47.87;
deny 43.153.50.155;
deny 43.153.50.27;
deny 43.153.51.23;
deny 43.153.52.160;
deny 43.153.52.194;
deny 43.153.53.83;
deny 43.153.55.37;
deny 43.153.56.217;
deny 43.153.56.5;
deny 43.153.56.95;
deny 43.153.57.138;
deny 43.153.60.149;
deny 43.153.60.47;
deny 43.153.6.134;
deny 43.153.62.172;
deny 43.153.63.91;
deny 43.153.67.234;
deny 43.153.67.54;
deny 43.153.68.5;
deny 43.153.69.59;
deny 43.153.71.150;
deny 43.153.76.111;
deny 43.153.76.2;
deny 43.153.79.217;
deny 43.153.79.50;
deny 43.153.79.89;
deny 43.153.81.186;
deny 43.153.8.120;
deny 43.153.82.145;
deny 43.153.82.7;
deny 43.153.83.118;
deny 43.153.83.196;
deny 43.153.83.59;
deny 43.153.84.62;
deny 43.153.85.130;
deny 43.153.85.215;
deny 43.153.85.82;
deny 43.153.86.66;
deny 43.153.87.79;
deny 43.153.89.190;
deny 43.153.90.32;
deny 43.153.93.155;
deny 43.153.93.161;
deny 43.153.94.27;
deny 43.153.9.46;
deny 43.153.97.141;
deny 43.153.97.176;
deny 43.153.97.38;
deny 43.153.98.145;
deny 43.153.99.204;
deny 43.156.108.209;
deny 43.156.109.108;
deny 43.156.109.221;
deny 43.156.109.53;
deny 43.156.111.86;
deny 43.156.113.170;
deny 43.156.121.150;
deny 43.156.12.198;
deny 43.156.127.99;
deny 43.156.130.44;
deny 43.156.131.167;
deny 43.156.132.155;
deny 43.156.135.243;
deny 43.156.137.109;
deny 43.156.139.132;
deny 43.156.1.4;
deny 43.156.140.158;
deny 43.156.14.12;
deny 43.156.142.236;
deny 43.156.143.143;
deny 43.156.143.59;
deny 43.156.145.188;
deny 43.156.145.239;
deny 43.156.149.198;
deny 43.156.149.204;
deny 43.156.151.117;
deny 43.156.154.135;
deny 43.156.155.156;
deny 43.156.156.96;
deny 43.156.157.10;
deny 43.156.16.160;
deny 43.156.163.239;
deny 43.156.166.233;
deny 43.156.167.172;
deny 43.156.168.214;
deny 43.156.170.156;
deny 43.156.174.168;
deny 43.156.180.229;
deny 43.156.181.129;
deny 43.156.181.230;
deny 43.156.19.147;
deny 43.156.19.159;
deny 43.156.199.108;
deny 43.156.19.94;
deny 43.156.200.77;
deny 43.156.201.106;
deny 43.156.20.247;
deny 43.156.204.178;
deny 43.156.204.195;
deny 43.156.210.113;
deny 43.156.210.157;
deny 43.156.21.101;
deny 43.156.212.198;
deny 43.156.22.164;
deny 43.156.224.111;
deny 43.156.2.249;
deny 43.156.225.142;
deny 43.156.227.211;
deny 43.156.230.101;
deny 43.156.230.156;
deny 43.156.23.168;
deny 43.156.236.211;
deny 43.156.237.110;
deny 43.156.240.113;
deny 43.156.240.69;
deny 43.156.240.90;
deny 43.156.243.82;
deny 43.156.248.180;
deny 43.156.248.40;
deny 43.156.250.60;
deny 43.156.25.131;
deny 43.156.253.100;
deny 43.156.253.221;
deny 43.156.30.95;
deny 43.156.31.106;
deny 43.156.31.120;
deny 43.156.31.139;
deny 43.156.31.85;
deny 43.156.32.240;
deny 43.156.32.96;
deny 43.156.33.223;
deny 43.156.35.138;
deny 43.156.37.233;
deny 43.156.38.162;
deny 43.156.38.206;
deny 43.156.39.119;
deny 43.156.39.81;
deny 43.156.4.192;
deny 43.156.42.109;
deny 43.156.42.80;
deny 43.156.43.11;
deny 43.156.44.27;
deny 43.156.4.49;
deny 43.156.48.91;
deny 43.156.50.203;
deny 43.156.53.26;
deny 43.156.57.102;
deny 43.156.58.108;
deny 43.156.58.245;
deny 43.156.58.86;
deny 43.156.61.42;
deny 43.156.6.145;
deny 43.156.63.171;
deny 43.156.67.10;
deny 43.156.68.213;
deny 43.156.69.248;
deny 43.156.72.13;
deny 43.156.74.207;
deny 43.156.78.202;
deny 43.156.82.24;
deny 43.156.87.26;
deny 43.156.89.212;
deny 43.156.93.94;
deny 43.159.128.110;
deny 43.159.129.55;
deny 43.159.130.145;
deny 43.159.131.146;
deny 43.159.132.141;
deny 43.159.133.235;
deny 43.159.134.121;
deny 43.159.134.84;
deny 43.159.135.112;
deny 43.159.135.174;
deny 43.159.138.216;
deny 43.159.138.49;
deny 43.159.139.141;
deny 43.159.140.135;
deny 43.159.140.146;
deny 43.159.140.172;
deny 43.159.140.176;
deny 43.159.140.179;
deny 43.159.140.180;
deny 43.159.140.190;
deny 43.159.140.21;
deny 43.159.140.250;
deny 43.159.140.254;
deny 43.159.140.28;
deny 43.159.140.48;
deny 43.159.140.65;
deny 43.159.140.70;
deny 43.159.140.74;
deny 43.159.140.83;
deny 43.159.140.94;
deny 43.159.141.185;
deny 43.159.142.11;
deny 43.159.144.235;
deny 43.159.145.176;
deny 43.159.145.18;
deny 43.159.145.60;
deny 43.159.145.92;
deny 43.159.146.186;
deny 43.159.147.63;
deny 43.159.160.108;
deny 43.159.160.11;
deny 43.159.160.114;
deny 43.159.160.120;
deny 43.159.160.123;
deny 43.159.160.124;
deny 43.159.160.126;
deny 43.159.160.131;
deny 43.159.160.141;
deny 43.159.160.143;
deny 43.159.160.156;
deny 43.159.160.158;
deny 43.159.160.163;
deny 43.159.160.167;
deny 43.159.160.175;
deny 43.159.160.182;
deny 43.159.160.183;
deny 43.159.160.185;
deny 43.159.160.187;
deny 43.159.160.190;
deny 43.159.160.192;
deny 43.159.160.195;
deny 43.159.160.201;
deny 43.159.160.208;
deny 43.159.160.211;
deny 43.159.160.223;
deny 43.159.160.232;
deny 43.159.160.237;
deny 43.159.160.24;
deny 43.159.160.242;
deny 43.159.160.244;
deny 43.159.160.251;
deny 43.159.160.27;
deny 43.159.160.39;
deny 43.159.160.40;
deny 43.159.160.43;
deny 43.159.160.49;
deny 43.159.160.53;
deny 43.159.160.54;
deny 43.159.160.58;
deny 43.159.160.6;
deny 43.159.160.65;
deny 43.159.160.70;
deny 43.159.160.84;
deny 43.159.160.88;
deny 43.159.160.9;
deny 43.159.160.92;
deny 43.159.160.95;
deny 43.159.160.98;
deny 43.159.34.141;
deny 43.159.35.219;
deny 43.159.35.56;
deny 43.159.38.195;
deny 43.159.41.42;
deny 43.159.43.98;
deny 43.159.44.53;
deny 43.159.45.228;
deny 43.159.51.82;
deny 43.159.56.73;
deny 43.159.57.103;
deny 43.159.63.156;
deny 43.163.0.139;
deny 43.163.1.85;
deny 43.163.2.111;
deny 43.163.2.202;
deny 43.163.2.90;
deny 43.163.3.166;
deny 43.163.3.209;
deny 43.163.4.235;
deny 43.163.5.194;
deny 43.163.6.124;
deny 43.163.6.157;
deny 43.163.6.161;
deny 43.163.7.250;
deny  49.51.192.157;
deny  49.51.50.25;
deny  49.51.241.200;
deny  49.51.48.129;
deny  49.51.202.65;
deny  49.51.71.69;
deny  49.51.248.68;
deny  49.51.52.94;
deny  49.51.202.222;
deny  49.51.39.168;
deny  119.28.110.71;
deny  49.51.231.192;
deny  49.51.197.230;
deny  119.28.113.173;
deny  49.51.245.28;
deny  49.51.202.75;
deny  49.51.244.201;
deny  49.51.192.98;
deny  119.28.104.45;
deny  49.51.250.18;
deny  49.51.204.242;
deny  49.51.203.159;
deny  49.51.184.72;
deny  49.51.183.31;
deny  49.51.183.180;
deny  49.51.36.40;
deny  49.51.33.188;
deny  49.51.244.91;
deny  49.51.197.88;
deny  49.51.179.1;
deny  49.51.72.115;
deny  49.51.242.73;
deny  49.51.207.133;
deny  49.51.197.184;
deny  119.28.108.252;
deny  49.51.231.203;
deny  119.28.101.129;
deny  49.51.50.117;
deny  49.51.37.135;
deny  49.51.243.249;
deny  119.28.105.216;
deny  49.51.41.174;
deny  49.51.248.137;
deny  49.51.202.229;
deny  49.51.192.50;
deny  49.51.184.229;
deny  49.51.183.14;
deny  49.51.35.202;
deny  49.51.183.149;
deny  49.51.70.77;
deny  49.51.46.92;
deny  49.51.253.50;
deny  49.51.243.216;
deny  49.51.233.241;
deny  49.51.200.205;
deny  49.51.37.129;
deny  49.51.253.206;
deny  49.51.243.48;
deny  49.51.199.185;
deny  49.51.183.90;
deny  49.51.230.30;
deny  49.51.199.133;
deny  49.51.183.32;
deny  49.51.50.75;
deny  49.51.33.132;
deny  49.51.230.97;
deny  49.51.201.166;
deny  49.51.187.39;
deny  49.51.68.80;
deny  49.51.207.34;
deny  49.51.68.252;
deny  49.51.41.31;
deny  49.51.245.247;
deny  49.51.244.249;
deny  119.28.111.186;
deny  49.51.248.246;
deny  49.51.243.56;
deny  49.51.232.248;
deny  49.51.197.254;
deny  49.51.202.228;
deny  49.51.179.198;
deny  49.51.47.93;
deny  49.51.40.159;
deny  49.51.189.144;
deny  119.28.116.30;
deny  119.28.103.74;
deny  49.51.39.158;
deny  49.51.35.242;
deny  49.51.35.235;
deny  49.51.204.252;
deny  49.51.72.209;
deny  49.51.40.76;
deny  49.51.207.114;
deny  49.51.183.21;
deny  49.51.183.23;
deny  119.28.106.237;
deny  49.51.232.34;
deny  49.51.248.69;
deny  49.51.244.247;
deny  49.51.228.91;
deny  49.51.183.253;
deny  49.51.183.251;
deny  119.28.101.125;
deny  49.51.252.31;
deny  49.51.252.227;
deny  49.51.206.168;
deny  49.51.231.204;
deny  49.51.188.241;
deny  49.51.204.120;
deny  49.51.191.192;
deny  49.51.247.228;
deny  49.51.183.110;

       allow all;
       if ($http_user_agent ~ (gptbot|libwww|Wget|LWP|damnBot|BBBike|java|spider|crawl|HUAWEIFRD-AL00|Scrapy|LMY47V|AhrefsBot) ) {
            return 403;
       }
        if ($http_user_agent ~* (DotBot|GPTBot|SemrushBot|HUAWEIFRD-AL00|Scrapy|LMY47V|MJ12bot|robot|ahrefs.com|bingbot|AspiegelBot) ) {
           return 403;
        }
        if ($http_user_agent ~* (google.com) ) {
           return 403;
        }
        proxy_redirect      off;
        proxy_set_header    Host                    $host;
        proxy_set_header    X-Real-IP               $remote_addr;
        proxy_set_header    X-Forwarded-For         $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Protocol    $scheme;
        #proxy_pass          http://dcn;
        proxy_pass          http://barbatos;
    }

    location /api/index/bulk/ {
        if ($http_user_agent ~ (libwww|Wget|LWP|damnBot|BBBike|java|spider|crawl) ) {
           return 403;
        }
        proxy_redirect      off;
        proxy_set_header    Host                    $host;
        proxy_set_header    X-Real-IP               $remote_addr;
        proxy_set_header    X-Forwarded-For         $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Protocol    $scheme;
        proxy_pass          http://rapid;
    }
    
    location /id {
        proxy_redirect      off;
        proxy_set_header    Host                    $host;
        proxy_set_header    X-Real-IP               $remote_addr;
        proxy_set_header    X-Forwarded-For         $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Protocol    $scheme;
        proxy_pass          http://rapid;
    }

    location /doc {
        proxy_redirect      off;
        proxy_set_header    Host                    $host;
        proxy_set_header    X-Real-IP               $remote_addr;
        proxy_set_header    X-Forwarded-For         $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Protocol    $scheme;
        proxy_pass          http://rapid;
    }

    rewrite ^/webresource/(.*.dzi)$ /fcgi-bin/iipsrv.fcgi?DeepZoom=/opt/hub3/dcn/webresource/$1 last;
    rewrite ^/webresource/(.*\.tif_files.*.jpg)$ /fcgi-bin/iipsrv.fcgi?DeepZoom=/opt/hub3/dcn/webresource/$1 last;


    location /webresource/ {
        root            /opt/hub3/dcn;
        access_log      on;
        log_not_found   on;
    }

    location /static/ {
        root            /opt/hub3/dcn/staging/nave_app/nave;
        access_log      off;
        log_not_found   off;
    }

    location /media/ {
        root            /opt/hub3/dcn/staging/nave_app/nave;
        access_log      off;
        log_not_found   off;
        # mp4;
        # mp4_buffer_size       1m;
        # mp4_max_buffer_size   5m;
        # flv;
    }

    location /watch/ {
        proxy_pass          http://127.0.0.1:3001;
        proxy_redirect      off;
        proxy_set_header    Host                    $host;
        proxy_set_header    X-Real-IP               $remote_addr;
        proxy_set_header    X-Forwarded-For         $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Protocol    $scheme;

        # basicauth
        auth_basic "narthex";
        auth_basic_user_file /opt/hub3/dcn/NarthexFiles/htpasswd_narthex;
    }

    location /imageproxy {
        proxy_pass          http://127.0.0.1:3002;
        proxy_redirect      off;
        proxy_set_header    Host                    $host;
        proxy_set_header    X-Real-IP               $remote_addr;
        proxy_set_header    X-Forwarded-For         $proxy_add_x_forwarded_for;
        proxy_set_header    X-Forwarded-Protocol    $scheme;
    }


    location /robots.txt {
        root            /opt/hub3/dcn/staging/nave_app/nave/projects/dcn/templates;
        access_log      off;
        log_not_found   off;
    }

    location /crossdomain.xml {
        root            /opt/hub3/dcn/staging/nave_app/nave/common/templates;
        access_log      off;
        log_not_found   off;
    }

    location /favicon.ico {
        root            /opt/hub3/dcn/staging/nave_app/nave/static/img;
        access_log      off;
        log_not_found   off;
    }


    
    location /narthex/ {
        client_max_body_size 250m;

        proxy_pass          http://91.98.126.153:9001;

        proxy_set_header    X-Real-IP               $remote_addr;
        proxy_set_header    Host                    $host;
        proxy_set_header    X-Forwarded-For         $proxy_add_x_forwarded_for;

        #proxy_redirect      off;
        #proxy_set_header    X-Forwarded-Protocol    $scheme;

        # basicauth
        auth_basic "narthex";
        auth_basic_user_file /opt/hub3/dcn/NarthexFiles/htpasswd_narthex;
    }

    location /narthex/socket/dataset {
        client_max_body_size 250m;

        proxy_pass          http://91.98.126.153:9001;

        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header Host $host;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

        # WebSockets
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

      # Increase timeouts for long-lived WebSocket connections
      proxy_read_timeout 3600s;  # 1 hour (was 300s = 5 minutes)
      proxy_send_timeout 3600s;  # 1 hour (add this)
      proxy_connect_timeout 60s; # Connection establishment timeout (add this)

        # basicauth
        auth_basic          off;
    }
    

    location /fcgi-bin/iipsrv.fcgi {
        add_header 'Access-Control-Allow-Origin' '*';
        add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';
        add_header 'Access-Control-Allow-Headers' 'DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type';
        fastcgi_pass  localhost:9000;
        fastcgi_param   PATH_INFO $fastcgi_script_name;
        fastcgi_param   REQUEST_METHOD $request_method;
        fastcgi_param   QUERY_STRING $query_string;
        fastcgi_param   CONTENT_TYPE $content_type;
        fastcgi_param   CONTENT_LENGTH $content_length;
        fastcgi_param   SERVER_PROTOCOL $server_protocol;
        fastcgi_param   REQUEST_URI $request_uri;
        fastcgi_param   HTTPS $https if_not_empty;
  }



    listen 443 http2 ssl; # managed by Certbot
    listen [::]:443 ssl http2;
    ssl_certificate /etc/letsencrypt/live/collectienederland.nl-0001/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/collectienederland.nl-0001/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot
















}

server {
    if ($host = prod.dcn.hubs.delving.org) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

    if ($host = prod.dcn.hubs.delving.io) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

    if ($host = data.collectienederland.nl) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

    if ($host = www.collectienederland.nl) {
        return 301 https://$host$request_uri;
    } # managed by Certbot

    if ($host = collectienederland.nl) {
        return 301 https://$host$request_uri;
    } # managed by Certbot


    server_name collectienederland.nl prod.dcn.hubs.delving.org data.collectienederland.nl www.collectienederland.nl .dimcon.nl prod.dcn.hubs.delving.io;
    listen 80;
    return 404; # managed by Certbot


}


